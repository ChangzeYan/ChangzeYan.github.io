<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"changzeyan.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="实体识别工具Pyhanlp安装先安装JDK。你需要保证JDK位数、操作系统位数和Python位数一致。然后设置JAVA_HOME环境变量，最后执行： # (可选)conda安装jpype1更方便 conda install -c conda-forge jpype1&#x3D;&#x3D;0.7.0       pip install pyhanlp  检测是否安装成功： hanlp  如果安装成功，会自动下载词典">
<meta property="og:type" content="article">
<meta property="og:title" content="实体识别">
<meta property="og:url" content="https://changzeyan.github.io/2021/02/10/python/nlp/shi-ti-shi-bie/index.html">
<meta property="og:site_name" content="YCZ">
<meta property="og:description" content="实体识别工具Pyhanlp安装先安装JDK。你需要保证JDK位数、操作系统位数和Python位数一致。然后设置JAVA_HOME环境变量，最后执行： # (可选)conda安装jpype1更方便 conda install -c conda-forge jpype1&#x3D;&#x3D;0.7.0       pip install pyhanlp  检测是否安装成功： hanlp  如果安装成功，会自动下载词典">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/hanlp-install-success.png">
<meta property="og:image" content="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/hanlp-segment.png">
<meta property="og:image" content="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/Chinese-BERT-wwm.png">
<meta property="article:published_time" content="2021-02-10T01:59:13.000Z">
<meta property="article:modified_time" content="2021-06-18T11:59:42.100Z">
<meta property="article:author" content="ChangzeYan">
<meta property="article:tag" content="NLP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/hanlp-install-success.png">

<link rel="canonical" href="https://changzeyan.github.io/2021/02/10/python/nlp/shi-ti-shi-bie/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>实体识别 | YCZ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="YCZ" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YCZ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">走向内心，寻求超越</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://changzeyan.github.io/2021/02/10/python/nlp/shi-ti-shi-bie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ChangzeYan">
      <meta itemprop="description" content="天空中没有留下翅膀的痕迹，但我已飞过">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YCZ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          实体识别
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-10 09:59:13" itemprop="dateCreated datePublished" datetime="2021-02-10T09:59:13+08:00">2021-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-18 19:59:42" itemprop="dateModified" datetime="2021-06-18T19:59:42+08:00">2021-06-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="实体识别工具"><a href="#实体识别工具" class="headerlink" title="实体识别工具"></a>实体识别工具</h1><h2 id="Pyhanlp"><a href="#Pyhanlp" class="headerlink" title="Pyhanlp"></a><a target="_blank" rel="noopener" href="https://github.com/hankcs/pyhanlp">Pyhanlp</a></h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>先安装JDK。你需要保证JDK位数、操作系统位数和Python位数一致。然后设置JAVA_HOME环境变量，最后执行：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># (可选)conda安装jpype1更方便</span>
conda <span class="token function">install</span> -c conda-forge jpype1<span class="token operator">==</span>0.7.0      
pip <span class="token function">install</span> pyhanlp
</code></pre>
<p>检测是否安装成功：</p>
<pre class=" language-bash"><code class="language-bash">hanlp
</code></pre>
<p>如果安装成功，会自动下载词典</p>
<p><img src="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/hanlp-install-success.png" alt="安装成功"></p>
<p>如果报RuntimeError: module compiled against API version 0xc but this version of numpy is 0xb，需要升级 numpy：</p>
<pre class=" language-bash"><code class="language-bash">pip <span class="token function">install</span> --upgrade numpy
</code></pre>
<h3 id="交互模式"><a href="#交互模式" class="headerlink" title="交互模式"></a>交互模式</h3><pre class=" language-bash"><code class="language-bash">hanlp segment
</code></pre>
<p><img src="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/hanlp-segment.png" alt="交互模式"></p>
<h3 id="hanlp词性表"><a href="#hanlp词性表" class="headerlink" title="hanlp词性表"></a>hanlp词性表</h3><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014258362/article/details/81044286">hanlp词性表</a></p>
<h2 id="StanfordCoreNLP"><a href="#StanfordCoreNLP" class="headerlink" title="StanfordCoreNLP"></a>StanfordCoreNLP</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><pre class=" language-bash"><code class="language-bash"> pip <span class="token function">install</span> stanfordcorenlp 
</code></pre>
<p>由于其源码为 JAVA 编写，所以需要 JDK1.8 及以上版本的支持，下载安装 JDK1.8。<br>下载 <a target="_blank" rel="noopener" href="https://stanfordnlp.github.io/CoreNLP/">StanfordCoreNLP 的相关文件</a>，解压到任意目录</p>
<p>如果要处理中文，还需下载中文jar包：<a target="_blank" rel="noopener" href="http://nlp.stanford.edu/software/stanford-chinese-corenlp-2018-10-05-models.jar">stanford-chinese-corenlp-2018-10-05-models</a>，下载完放到上一步解压后的文件夹中。</p>
<h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> stanfordcorenlp <span class="token keyword">import</span> StanfordCoreNLP
 
<span class="token comment" spellcheck="true"># 加载模型，路径是上面解压的路径</span>
stanford_model <span class="token operator">=</span> StanfordCoreNLP<span class="token punctuation">(</span>r<span class="token string">'./stanford-corenlp-full-2018-02-27'</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">'zh'</span><span class="token punctuation">)</span>
 
text <span class="token operator">=</span> <span class="token string">"张三和李四在2019年3月23日在北京的腾讯技术有限公司一起开会。"</span>
 
res <span class="token operator">=</span> stanford_model<span class="token punctuation">.</span>ner<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre>
<p>参数：<br>处理英文时：lang=’en’</p>
<h2 id="kashgari"><a href="#kashgari" class="headerlink" title="kashgari"></a>kashgari</h2><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27492735/article/details/108767237">Kashgari:一个方便快捷的命名实体识别、文本分类工具包</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mingriyingying/p/13379434.html">NER-使用kashgari中的Bert+BiLSTM+CRF</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1d6689851622">五分钟搭建一个基于BERT的NER模型</a></li>
<li><a target="_blank" rel="noopener" href="https://kashgari-zh.bmio.net/tutorial/text-labeling/">kashgari-zh.bmio.net</a></li>
<li><a target="_blank" rel="noopener" href="https://shfshf.github.io/2019/12/26/Kashgari/">Kashgari概述</a></li>
</ul>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><pre class=" language-bash"><code class="language-bash">conda create --envs myTestNER python<span class="token operator">==</span>3.6
pip insall tensorflow<span class="token operator">==</span>1.14.0
pip <span class="token function">install</span> kashgari<span class="token operator">==</span>1.1.5
</code></pre>
<h3 id="下载模型"><a href="#下载模型" class="headerlink" title="下载模型"></a>下载模型</h3><p><a target="_blank" rel="noopener" href="https://github.com/ymcui/Chinese-BERT-wwm/">中文模型</a></p>
<p><img src="https://github.com/ChangzeYan/ChangzeYan.github.io/raw/hexo/source/pic/Chinese-BERT-wwm.png" alt="中文模型下载"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/google-research/bert">英文模型</a></p>
<h3 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h3><p>训练集、测试集、验证集的格式均为：</p>
<pre><code>我 O
们 O
变 O
而 O
以 O
书 O
会 O
友 O
， O
把 O
欧 B-LOC
美 B-LOC
流 O
行 O
的 O
食 O
品 O
类 O
图 O
谱 O
、 O
画 O
册 O
</code></pre>
<h3 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Tuple<span class="token punctuation">,</span> List

<span class="token comment" spellcheck="true"># 定义一个读取数据的类</span>
<span class="token keyword">class</span> <span class="token class-name">DataReader</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">read_file</span><span class="token punctuation">(</span>file_path<span class="token punctuation">:</span> str<span class="token punctuation">,</span>
                  text_index<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
                  label_index<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Tuple<span class="token punctuation">[</span>List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span>List<span class="token punctuation">[</span>str<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        根据文件路径读取训练数据、测试数据以及验证数据的text和label
        """</span>
        x_data<span class="token punctuation">,</span> y_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> open<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            lines <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 以splitlines的方式获取数据</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
                rows <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 以空格进行切分</span>
                <span class="token keyword">if</span> len<span class="token punctuation">(</span>rows<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                    x_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                    y_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
                    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rows<span class="token punctuation">[</span>text_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rows<span class="token punctuation">[</span>label_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> x_data<span class="token punctuation">,</span> y_data
</code></pre>
<h3 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> kashgari
<span class="token keyword">from</span> kashgari <span class="token keyword">import</span> utils
<span class="token keyword">from</span> kashgari<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> BERTEmbedding<span class="token punctuation">,</span> BERTEmbeddingV2
<span class="token keyword">from</span> kashgari<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>labeling <span class="token keyword">import</span> BiLSTM_CRF_Model
<span class="token keyword">from</span> data_load <span class="token keyword">import</span> DataReader

kashgari<span class="token punctuation">.</span>config<span class="token punctuation">.</span>use_cudnn_cell <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token comment" spellcheck="true"># 加载训练数据、验证数据以及测试数据</span>

train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> DataReader<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'../data/train.txt'</span><span class="token punctuation">)</span>
test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> DataReader<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'../data/test.txt'</span><span class="token punctuation">)</span>
valid_x<span class="token punctuation">,</span> valid_y <span class="token operator">=</span> DataReader<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'../data/new_val.txt'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train data count: &amp;#123;len(train_x)&amp;#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"validate data count: &amp;#123;len(valid_x)&amp;#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"test data count: &amp;#123;len(test_x)&amp;#125;"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 利用kashgari创建Bert Embedding</span>

bert_embed <span class="token operator">=</span> BERTEmbedding<span class="token punctuation">(</span><span class="token string">'chinese_wwm_ext_L-12_H-768_A-12'</span><span class="token punctuation">,</span>
                           task<span class="token operator">=</span>kashgari<span class="token punctuation">.</span>LABELING<span class="token punctuation">,</span>
                           sequence_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 调用BiLSTM_CRF_Model模型并进行训练</span>

model <span class="token operator">=</span> BiLSTM_CRF_Model<span class="token punctuation">(</span>bert_embed<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>x_train<span class="token operator">=</span>train_x<span class="token punctuation">,</span> y_train<span class="token operator">=</span>train_y<span class="token punctuation">,</span>
          x_validate<span class="token operator">=</span>valid_x<span class="token punctuation">,</span> y_validate<span class="token operator">=</span>valid_y<span class="token punctuation">,</span>
          batch_size<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./model/NER.h5'</span><span class="token punctuation">)</span>

model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'小'</span><span class="token punctuation">,</span> <span class="token string">'明'</span><span class="token punctuation">,</span> <span class="token string">'在'</span><span class="token punctuation">,</span> <span class="token string">'商'</span><span class="token punctuation">,</span> <span class="token string">'务'</span><span class="token punctuation">,</span> <span class="token string">'部'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="使用自带的人民日报数据"><a href="#使用自带的人民日报数据" class="headerlink" title="使用自带的人民日报数据"></a>使用自带的人民日报数据</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> jieba
<span class="token keyword">from</span> kashgari<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>seq_labeling <span class="token keyword">import</span> BLSTMCRFModel
<span class="token keyword">from</span> kashgari<span class="token punctuation">.</span>corpus <span class="token keyword">import</span> ChinaPeoplesDailyNerCorpus
<span class="token keyword">from</span> kashgari<span class="token punctuation">.</span>embeddings <span class="token keyword">import</span> BERTEmbedding
embedding <span class="token operator">=</span> BERTEmbedding<span class="token punctuation">(</span><span class="token string">'/home/eee/sentence-alignment-classification-model/model/multi_cased_L-12_H-768_A-12'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
 
train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> ChinaPeoplesDailyNerCorpus<span class="token punctuation">.</span>get_sequence_tagging_data<span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">)</span>
validate_x<span class="token punctuation">,</span> validate_y <span class="token operator">=</span> ChinaPeoplesDailyNerCorpus<span class="token punctuation">.</span>get_sequence_tagging_data<span class="token punctuation">(</span><span class="token string">'validate'</span><span class="token punctuation">)</span>
test_x<span class="token punctuation">,</span> test_y  <span class="token operator">=</span> ChinaPeoplesDailyNerCorpus<span class="token punctuation">.</span>get_sequence_tagging_data<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
 
model <span class="token operator">=</span> BLSTMCRFModel<span class="token punctuation">(</span>embedding<span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span>
          train_y<span class="token punctuation">,</span>
          validate_y<span class="token operator">=</span>validate_y<span class="token punctuation">,</span>
          validate_x<span class="token operator">=</span>validate_x<span class="token punctuation">,</span>
          epochs<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span>
          batch_size<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./model'</span><span class="token punctuation">)</span>
 
new_model <span class="token operator">=</span> BLSTMCRFModel<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">'./model'</span><span class="token punctuation">)</span>
 
<span class="token comment" spellcheck="true"># EXAMPLE 1</span>
news <span class="token operator">=</span> <span class="token string">"「DeepMind 击败人类职业玩家的方式与他们声称的 AI 使命，以及所声称的『正确』方式完全相反。」"</span>
x <span class="token operator">=</span> list<span class="token punctuation">(</span>jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>news<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> x
<span class="token punctuation">[</span><span class="token string">'「'</span><span class="token punctuation">,</span> <span class="token string">'DeepMind'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'击败'</span><span class="token punctuation">,</span> <span class="token string">'人类'</span><span class="token punctuation">,</span> <span class="token string">'职业'</span><span class="token punctuation">,</span> <span class="token string">'玩家'</span><span class="token punctuation">,</span> <span class="token string">'的'</span><span class="token punctuation">,</span> <span class="token string">'方式'</span><span class="token punctuation">,</span> <span class="token string">'与'</span><span class="token punctuation">,</span> <span class="token string">'他们'</span><span class="token punctuation">,</span> <span class="token string">'声称'</span><span class="token punctuation">,</span> <span class="token string">'的'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'AI'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'使命'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'以及'</span><span class="token punctuation">,</span> <span class="token string">'所'</span><span class="token punctuation">,</span> <span class="token string">'声称'</span><span class="token punctuation">,</span> <span class="token string">'的'</span><span class="token punctuation">,</span> <span class="token string">'『'</span><span class="token punctuation">,</span> <span class="token string">'正确'</span><span class="token punctuation">,</span> <span class="token string">'』'</span><span class="token punctuation">,</span> <span class="token string">'方式'</span><span class="token punctuation">,</span> <span class="token string">'完全'</span><span class="token punctuation">,</span> <span class="token string">'相反'</span><span class="token punctuation">,</span> <span class="token string">'。'</span><span class="token punctuation">,</span> <span class="token string">'」'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> new_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>                                                                                                     
<span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">]</span>
 
<span class="token comment" spellcheck="true"># EXAMPLE 2</span>
news <span class="token operator">=</span> <span class="token string">"陈志衍是有个非常好的男孩子，他住在香港的九龙塘区，他今年二十三号生日。"</span>
x <span class="token operator">=</span> list<span class="token punctuation">(</span>jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>news<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> x
<span class="token punctuation">[</span><span class="token string">'陈志衍'</span><span class="token punctuation">,</span> <span class="token string">'是'</span><span class="token punctuation">,</span> <span class="token string">'有'</span><span class="token punctuation">,</span> <span class="token string">'个'</span><span class="token punctuation">,</span> <span class="token string">'非常'</span><span class="token punctuation">,</span> <span class="token string">'好'</span><span class="token punctuation">,</span> <span class="token string">'的'</span><span class="token punctuation">,</span> <span class="token string">'男孩子'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'他'</span><span class="token punctuation">,</span> <span class="token string">'住'</span><span class="token punctuation">,</span> <span class="token string">'在'</span><span class="token punctuation">,</span> <span class="token string">'香港'</span><span class="token punctuation">,</span> <span class="token string">'的'</span><span class="token punctuation">,</span> <span class="token string">'吉林'</span><span class="token punctuation">,</span> <span class="token string">'区'</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">'他'</span><span class="token punctuation">,</span> <span class="token string">'今年'</span><span class="token punctuation">,</span> <span class="token string">'二十三'</span><span class="token punctuation">,</span> <span class="token string">'号'</span><span class="token punctuation">,</span> <span class="token string">'生日'</span><span class="token punctuation">,</span> <span class="token string">'。'</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> new_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">]</span>
</code></pre>
<h3 id="自带数据集"><a href="#自带数据集" class="headerlink" title="自带数据集"></a>自带数据集</h3><pre><code>加载内置数据集
中文数据集
from kashgari.corpus import ChineseDailyNerCorpus

train_x, train_y = ChineseDailyNerCorpus.load_data(&#39;train&#39;)
valid_x, valid_y = ChineseDailyNerCorpus.load_data(&#39;valid&#39;)
test_x, test_y = ChineseDailyNerCorpus.load_data(&#39;test&#39;)

英文数据集
from kashgari.corpus import CONLL2003ENCorpus

train_x, train_y = CONLL2003ENCorpus.load_data(&#39;train&#39;)
valid_x, valid_y = CONLL2003ENCorpus.load_data(&#39;valid&#39;)
test_x, test_y = CONLL2003ENCorpus.load_data(&#39;test&#39;)

# 也可以使用自己的数据集
train_x = [[&#39;Hello&#39;, &#39;world&#39;], [&#39;Hello&#39;, &#39;Kashgari&#39;], [&#39;I&#39;, &#39;love&#39;, &#39;Beijing&#39;]]
train_y = [[&#39;O&#39;, &#39;O&#39;], [&#39;O&#39;, &#39;B-PER&#39;], [&#39;O&#39;, &#39;B-LOC&#39;]]

valid_x, valid_y = train_x, train_y
test_x, test_x = train_x, train_y
</code></pre>
<h2 id="stanza"><a href="#stanza" class="headerlink" title="stanza"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/HcX8b84YazwVI-usWsCUew">stanza</a></h2><h2 id="LTP"><a href="#LTP" class="headerlink" title="LTP"></a>LTP</h2><p>参考：<a target="_blank" rel="noopener" href="https://ltp.readthedocs.io/zh_CN/latest/index.html">LTP4 文档</a></p>
<h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><pre><code>pip install ltp
</code></pre>
<h3 id="加载模型"><a href="#加载模型" class="headerlink" title="加载模型"></a>加载模型</h3><pre><code>from ltp import LTP
ltp = LTP() # 默认加载 Small 模型
# ltp = LTP(path = &quot;base|small|tiny&quot;)
# ltp = LTP(path = &quot;tiny.tgz|tiny-tgz-extracted&quot;) # 其中 tiny-tgz-extracted 是 tiny.tgz 解压出来的文件夹
</code></pre>
<h3 id="命名实体识别"><a href="#命名实体识别" class="headerlink" title="命名实体识别"></a>命名实体识别</h3><pre><code>from ltp import LTP

ltp = LTP()

seg, hidden = ltp.seg([&quot;他叫汤姆去拿外衣。&quot;])
ner = ltp.ner(hidden)
# [[&#39;他&#39;, &#39;叫&#39;, &#39;汤姆&#39;, &#39;去&#39;, &#39;拿&#39;, &#39;外衣&#39;, &#39;。&#39;]]
# [[(&#39;Nh&#39;, 2, 2)]]

tag, start, end = ner[0][0]
print(tag,&quot;:&quot;, &quot;&quot;.join(seg[0][start:end + 1]))
# Nh : 汤姆
</code></pre>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/NLP/" rel="tag"># NLP</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/01/28/python/python-yu-fa/python-str/" rel="prev" title="Python-str">
      <i class="fa fa-chevron-left"></i> Python-str
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/10/python/python-yu-fa/pip/" rel="next" title="Pip">
      Pip <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB%E5%B7%A5%E5%85%B7"><span class="nav-number">1.</span> <span class="nav-text">实体识别工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pyhanlp"><span class="nav-number">1.1.</span> <span class="nav-text">Pyhanlp</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">1.1.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text">交互模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hanlp%E8%AF%8D%E6%80%A7%E8%A1%A8"><span class="nav-number">1.1.3.</span> <span class="nav-text">hanlp词性表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#StanfordCoreNLP"><span class="nav-number">1.2.</span> <span class="nav-text">StanfordCoreNLP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kashgari"><span class="nav-number">1.3.</span> <span class="nav-text">kashgari</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.3.1.</span> <span class="nav-text">环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.3.2.</span> <span class="nav-text">下载模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.3.3.</span> <span class="nav-text">数据格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.4.</span> <span class="nav-text">读取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%AD%E7%BB%83"><span class="nav-number">1.3.5.</span> <span class="nav-text">训练</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B8%A6%E7%9A%84%E4%BA%BA%E6%B0%91%E6%97%A5%E6%8A%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">1.3.6.</span> <span class="nav-text">使用自带的人民日报数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%B8%A6%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="nav-number">1.3.7.</span> <span class="nav-text">自带数据集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stanza"><span class="nav-number">1.4.</span> <span class="nav-text">stanza</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LTP"><span class="nav-number">1.5.</span> <span class="nav-text">LTP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-2"><span class="nav-number">1.5.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.5.2.</span> <span class="nav-text">加载模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E5%AE%9E%E4%BD%93%E8%AF%86%E5%88%AB"><span class="nav-number">1.5.3.</span> <span class="nav-text">命名实体识别</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ChangzeYan</p>
  <div class="site-description" itemprop="description">天空中没有留下翅膀的痕迹，但我已飞过</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ChangzeYan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
